{% comment %}
  Compact Product Meta Info (EAN, Brand, Availability)
  Displayed in a single horizontal line to save space
{% endcomment %}

<div class="product-meta-compact">
  {% if product.selected_or_first_available_variant.barcode != blank %}
    <span class="meta-item">
      <i class="fa-solid fa-barcode"></i>
      <strong>EAN:</strong> <span id="eanValue">{{ product.selected_or_first_available_variant.barcode }}</span>
    </span>
  {% endif %}
  
  {% if product.vendor != blank %}
    <span class="meta-item">
      <i class="fa-solid fa-tag"></i>
      <strong>Marke:</strong> 
      {% assign vendor_handle = product.vendor | handleize %}
      <a class="brand-link" href="/collections/{{ vendor_handle }}">{{ product.vendor }}</a>
    </span>
  {% endif %}
  
  <span class="meta-item">
    <i class="fa-solid {% if is_digital %}fa-download{% else %}fa-box-open{% endif %}"></i>
    <strong>{% if is_digital %}Verfügbarkeit:{% else %}Lieferbar:{% endif %}</strong>
    <span id="availabilityValue">
      {% if product.selected_or_first_available_variant.available %}
        {% if is_digital %}
          <span class="status-available">Versand per E-Mail sofort</span>
        {% else %}
          {% if long_shipping and ship_dt != blank %}
            <span class="status-delayed">ab {{ ship_dt | date: "%-d. %B %Y" }}</span>
          {% else %}
            <span class="status-available" id="delivery-date-text">
              Wird berechnet...
            </span>
          {% endif %}
        {% endif %}
      {% else %}
        <span class="status-unavailable">Nicht verfügbar</span>
      {% endif %}
    </span>
  </span>
</div>

<script>
(function() {
  function getNextBusinessDay() {
    const today = new Date();
    let deliveryDate = new Date(today);
    deliveryDate.setDate(deliveryDate.getDate() + 1); // Next day
    
    // Skip Saturday (6) and Sunday (0)
    while (deliveryDate.getDay() === 0 || deliveryDate.getDay() === 6) {
      deliveryDate.setDate(deliveryDate.getDate() + 1);
    }
    
    return deliveryDate;
  }
  
  function formatDate(date) {
    const days = ['Sonntag', 'Montag', 'Dienstag', 'Mittwoch', 'Donnerstag', 'Freitag', 'Samstag'];
    const months = ['Januar', 'Februar', 'März', 'April', 'Mai', 'Juni', 'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'];
    
    const dayName = days[date.getDay()];
    const day = date.getDate();
    const month = months[date.getMonth()];
    
    return dayName + ', ' + day + '. ' + month;
  }
  
  const deliveryEl = document.getElementById('delivery-date-text');
  if (deliveryEl) {
    const deliveryDate = getNextBusinessDay();
    const christmas = new Date('2025-12-24');
    const today = new Date();
    
    let text = 'Lieferung: ' + formatDate(deliveryDate);
    
    // Add Christmas notice if before Dec 24
    if (today < christmas) {
      text += ' (nach Weihnachten)';
    }
    
    deliveryEl.textContent = text;
  }
})();
</script>

<style>
.product-meta-compact {
  display: flex;
  flex-direction: column;
  gap: 8px;
  padding: 12px 0 0 0;
  font-size: 13px;
  color: #555;
  border-top: 1px solid #e5e5e5;
  margin-top: 16px;
  margin-bottom: 0;
}
.meta-item {
  display: inline-flex;
  align-items: center;
  gap: 5px;
}
.meta-item i {
  color: #1d4739;
  font-size: 14px;
  min-width: 16px;
}
.meta-item strong {
  font-weight: 600;
  color: #333;
}
.brand-link {
  color: #1d4739;
  text-decoration: none;
  font-weight: 600;
}
.brand-link:hover {
  text-decoration: underline;
}
.status-available {
  color: #1d7a34;
  font-weight: 600;
}
.status-delayed {
  color: #f57c00;
  font-weight: 600;
}
.status-unavailable {
  color: #c00;
  font-weight: 600;
}

/* Force hide countdown timer */
.countdown-timer,
.countdown-timer-green,
[class*="countdown"],
[id*="countdown"] {
  display: none !important;
}
</style>
