{% comment %}
  Urgency Elements: Sales Counter + Countdown Timer
  Optimized for conversion - shown before price
{% endcomment %}

<!-- Compact Sales Counter -->
<div id="sales-box-{{ product.id }}" class="sales-compact">
  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#ff5722" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
    <polyline points="17 6 23 6 23 12"></polyline>
  </svg>
  <span class="sales-text">
    <strong id="sales-count-{{ product.id }}">--</strong> Verkäufe in den letzten 24 Stunden
    <span class="sales-time">• Letzter Verkauf: <strong id="last-sale-{{ product.id }}">vor ...</strong></span>
  </span>
</div>

<style>
.sales-compact {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 0;
  font-size: 14px;
  color: #d84315;
  margin: 8px 0;
}
.sales-compact svg { flex-shrink: 0; }
.sales-text { display: flex; flex-wrap: wrap; gap: 6px; align-items: baseline; }
.sales-text strong { font-weight: 700; }
.sales-time { font-size: 13px; color: #666; }
</style>

<script>
(function() {
  const pid = {{ product.id }};
  
  // Smart Sales Counter Logic
  const key = 'sales_' + pid;
  const timeKey = 'sale_time_' + pid;
  const dateKey = 'sales_date_' + pid;
  
  const today = new Date().toDateString();
  const storedDate = localStorage.getItem(dateKey);
  
  // Reset counter if it's a new day
  if (storedDate !== today) {
    localStorage.removeItem(key);
    localStorage.removeItem(timeKey);
    localStorage.setItem(dateKey, today);
  }
  
  // Calculate base sales count (varies by product ID)
  const baseCount = 40 + (pid % 56);
  
  // Add time-based variation (more sales during peak hours)
  const hour = new Date().getHours();
  let timeBonus = 0;
  if (hour >= 10 && hour <= 12) timeBonus = 5; // Morning peak
  else if (hour >= 18 && hour <= 21) timeBonus = 8; // Evening peak
  
  // Calculate smart count
  const smartCount = baseCount + timeBonus + Math.floor(Math.random() * 10);
  
  let count = parseInt(localStorage.getItem(key)) || smartCount;
  
  // Gradually increase count throughout the day
  const minutesSinceMidnight = new Date().getHours() * 60 + new Date().getMinutes();
  const increment = Math.floor(minutesSinceMidnight / 60); // +1 every hour
  count = Math.min(count + increment, smartCount + 20);
  
  localStorage.setItem(key, count);
  
  const countEl = document.getElementById('sales-count-' + pid);
  const timeEl = document.getElementById('last-sale-' + pid);
  
  if (countEl) countEl.textContent = count;
  
  // Smart last sale time (more recent during peak hours)
  let saleTime = localStorage.getItem(timeKey);
  const now = Date.now();
  if (!saleTime) {
    const maxMinutes = (hour >= 10 && hour <= 21) ? 15 : 45; // Recent during peak
    saleTime = now - (Math.floor(Math.random() * maxMinutes) + 3) * 60000;
    localStorage.setItem(timeKey, saleTime);
  }
  
  function updateSaleTime() {
    const diff = Math.floor((Date.now() - parseInt(saleTime)) / 60000);
    if (timeEl) timeEl.textContent = 'vor ' + (diff > 60 ? 60 : diff) + ' Min.';
  }
  updateSaleTime();
  setInterval(updateSaleTime, 60000);
})();
</script>

